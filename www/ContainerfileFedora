From quay.io/fedora/fedora-minimal:40

# Installs DNF, upgrades packages, installs python pip (python3.12 is already included in fedora 40)
# installs RPMfusion repos and finally installs ffmpeg and ffmpeg-devel
RUN microdnf install dnf -y && dnf upgrade --refresh -y && \
dnf install -y python3-pip && \
dnf install -y \
https://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-$(rpm -E %fedora).noarch.rpm \
https://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-$(rpm -E %fedora).noarch.rpm && \
dnf install ffmpeg -y && \
dnf install ffmpeg-devel -y



# Set the working directory
WORKDIR /www
ENV PYTHONPATH /www

# Copy requirements.txt
COPY requirements.txt .

# Install dependencies
RUN pip install -r requirements.txt

# Change to the working directory

# Copy the current directory contents into the container at /www
ENTRYPOINT ["gunicorn", "app:flask_app", "--config", "/www/gunicorn_config.py"]

HEALTHCHECK --interval=10s --timeout=3s CMD curl --fail http://localhost:8000/health|| exit 1


